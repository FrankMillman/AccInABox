<form name="setup_form_memobj">

  <db_objects/>
  <mem_objects>

    <mem_obj name="form" descr="Variables used in form">
      <mem_col col_name="form_name" data_type="TEXT" short_descr="Form name"
        long_descr="Form name" col_head="Name" key_field="N" allow_null="false"
        allow_amend="false" max_len="0" db_scale="0"/>
      <mem_col col_name="title" data_type="TEXT" short_descr="Title"
        long_descr="Form title" col_head="Title" key_field="N" allow_null="false"
        allow_amend="false" max_len="0" db_scale="0"/>
      <mem_col col_name="form_xml" data_type="FXML" short_descr="Form definition"
        long_descr="Form definition (xml)" col_head="Defn" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0"/>
    </mem_obj>

    <mem_obj name="memobj" descr="Mem objects used in form" parent="form"
        sequence="[`seq`, [], null]">
      <mem_col col_name="form_name" data_type="TEXT" short_descr="Form name"
        long_descr="Form name" col_head="Name" key_field="N" allow_null="false"
        allow_amend="false" max_len="0" db_scale="0"
        fkey="[`form`, `form_name`, null, null, true]"/>
      <mem_col col_name="seq" data_type="INT" short_descr="Sequence"
        long_descr="Sequence" col_head="Seq" key_field="N"
        allow_null="false" allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="name" data_type="TEXT" short_descr="Object name"
        long_descr="Object name" col_head="Object" key_field="A" allow_null="false"
        allow_amend="false" max_len="20" db_scale="0"/>
      <mem_col col_name="descr" data_type="TEXT" short_descr="Description"
        long_descr="Description" col_head="Description" key_field="N" allow_null="false"
        allow_amend="true" max_len="30" db_scale="0"/>
      <mem_col col_name="parent" data_type="TEXT" short_descr="Parent"
        long_descr="Parent" col_head="Parent" key_field="N" allow_null="true"
        allow_amend="true" max_len="30" db_scale="0"/>
      <mem_col col_name="sequence" data_type="JSON" short_descr="Sequence"
        long_descr="Sequence" col_head="Sequence" key_field="N" allow_null="true"
        allow_amend="true" max_len="30" db_scale="0"/>
    </mem_obj>

<!-- 'hooks' not used at present [2015-04-26] - do not remove code in case required in future
    <mem_obj name="memhooks" descr="Table hooks for mem objects" parent="memobj"
        sequence="[`seq`, [`memobj_name`], null]">
      <mem_col col_name="type" data_type="TEXT" short_descr="Hook type"
        long_descr="Hook type" col_head="Hook type" key_field="A" allow_null="false"
        allow_amend="false" max_len="15" db_scale="0"
        choices="[false, false, [
          [`on_setup`, `On setting up object`, [], []],
          [`after_read`, `After row selected`, [], []],
          [`after_init`, `After row initialised`, [], []],
          [`after_restore`, `After row restored`, [], []],
          [`before_save`, `Before row saved`, [], []],
          [`after_save`, `After row saved and committed`, [], []],
          [`before_insert`, `Before insert`, [], []],
          [`after_insert`, `After insert, before commit`, [], []],
          [`before_update`, `Before update`, [], []],
          [`after_update`, `After update, before commit`, [], []],
          [`before_delete`, `Before delete`, [], []],
          [`after_delete`, `After delete, before commit`, [], []]
          ]]"
        />
      <mem_col col_name="action" data_type="SXML" short_descr="Hook action"
        long_descr="Action to be performed" col_head="Action" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="memobj_name" data_type="TEXT" short_descr="Object name"
        long_descr="Object name" col_head="Object" key_field="A" allow_null="false"
        allow_amend="false" max_len="20" db_scale="0"
        fkey="[`memobj`, `name`, null, null, true]"/>
      <mem_col col_name="seq" data_type="INT" short_descr="Sequence"
        long_descr="Sequence" col_head="Seq" key_field="N"
        allow_null="false" allow_amend="true" max_len="0" db_scale="0"/>
    </mem_obj>
-->

    <mem_obj name="memcol" descr="Column defns for mem objects" parent="memobj"
        sequence="[`seq`, [`memobj_name`], null]">
      <mem_col col_name="col_name" data_type="TEXT" short_descr="Column name"
        long_descr="Column name" col_head="Column name" key_field="A" allow_null="false"
        allow_amend="false" max_len="20" db_scale="0"/>
      <mem_col col_name="data_type" data_type="TEXT" short_descr="Data type"
        long_descr="Data type" col_head="Data type" key_field="N" allow_null="false"
        allow_amend="true" max_len="5" db_scale="0"
        choices="[false, false, [[`TEXT`, `Text`, [], []], [`INT`, `Integer`, [], []],
        [`DEC`, `Decimal`, [], []], [`DTE`, `Date`, [], []], [`DTM`, `Date-time`, [], []],
        [`BOOL`, `True/False`, [], []], [`JSON`, `Json`, [], []],
        [`XML`, `Xml`, [], []], [`SXML`, `Xml string`, [], []]]]"/>
      <mem_col col_name="short_descr" data_type="TEXT" short_descr="Short description"
        long_descr="Short description" col_head="Description" key_field="N" allow_null="false"
        allow_amend="true" max_len="30" db_scale="0"/>
      <mem_col col_name="long_descr" data_type="TEXT" short_descr="Long description"
        long_descr="Long description" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="col_head" data_type="TEXT" short_descr="Col head"
        long_descr="Column heading" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="15" db_scale="0"/>
      <mem_col col_name="key_field" data_type="TEXT" short_descr="Key field"
        long_descr="Alt=Alternate key; No=Not a key field" col_head="" key_field="N"
        allow_null="false" allow_amend="true" max_len="1" db_scale="0"
        choices="[false, false, [[`A`, `Alt`, [], []], [`N`, `No`, [], []]]]"/>
      <mem_col col_name="allow_null" data_type="BOOL" short_descr="Allow null"
        long_descr="Allow null" col_head="" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="allow_amend" data_type="BOOL" short_descr="Allow amend"
        long_descr="Allow amend" col_head="" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="max_len" data_type="INT" short_descr="Max length"
        long_descr="Maximum length" col_head="" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0" dflt_val="0"/>
      <mem_col col_name="db_scale" data_type="INT" short_descr="Db scale"
        long_descr="Decimal places in database" col_head="" key_field="N" allow_null="false"
        allow_amend="true" max_len="0" db_scale="0" dflt_val="0"/>
      <mem_col col_name="scale_ptr" data_type="TEXT" short_descr="Scale pointer"
        long_descr="Scale pointer" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="dflt_val" data_type="TEXT" short_descr="Default value"
        long_descr="Default value" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="col_chks" data_type="JSON" short_descr="Column checks"
        long_descr="Column checks" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="fkey" data_type="JSON" short_descr="Foreign key"
        long_descr="Foreign key" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="choices" data_type="JSON" short_descr="Choices"
        long_descr="List of valid choices" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="sql" data_type="TEXT" short_descr="Sql"
        long_descr="Sql statement" col_head="" key_field="N" allow_null="true"
        allow_amend="true" max_len="0" db_scale="0"/>
      <mem_col col_name="memobj_name" data_type="TEXT" short_descr="Object name"
        long_descr="Object name" col_head="Object" key_field="A" allow_null="false"
        allow_amend="false" max_len="20" db_scale="0"
        fkey="[`memobj`, `name`, null, null, true]"/>
      <mem_col col_name="seq" data_type="INT" short_descr="Sequence"
        long_descr="Sequence" col_head="Seq" key_field="N"
        allow_null="false" allow_amend="true" max_len="0" db_scale="0"/>
    </mem_obj>
  </mem_objects>

  <input_params>
    <input_param name="form_name" type="data_attr" target="form.form_name" required="true"/>
    <input_param name="title" type="data_attr" target="form.title" required="true"/>
    <input_param name="form_xml" type="data_attr" target="form.form_xml" required="true"/>
  </input_params>

  <output_params>
    <output_param name="form_xml" type="data_attr" source="form.form_xml"/>
  </output_params>

  <frame main_object="form">
    <toolbar/>
    <body>
      <block/>
      <panel/>
      <row/>
      <col/>
      <label value="Form name:"/>
      <col/>
      <display fld="form.form_name" lng="160"/>
      <col/>
      <label value="Title:"/>
      <col/>
      <display fld="form.title" lng="250"/>

      <block/>
      <grid data_object="memobj" growable="true" num_grid_rows="2">
        <toolbar template="Grid"/>
        <cur_columns>
          <cur_col col_name="name" lng="120"/>
          <cur_col col_name="descr" lng="200" expand="true"/>
          <cur_col col_name="parent" lng="120"/>
          <cur_col col_name="sequence" lng="120"/>
        </cur_columns>
        <cur_filter/>
        <cur_sequence>
          <cur_seq col_name="seq"/>
        </cur_sequence>
        <grid_methods template="Grid"/>
      </grid>

      <block/>
      <grid_frame main_object="memobj">
        <toolbar/>
        <body>
          <block/>
          <grid data_object="memcol" growable="true" num_grid_rows="10">
            <toolbar template="Grid"/>
            <cur_columns>
              <cur_col col_name="col_name" lng="80"/>
            </cur_columns>
            <cur_filter/>
            <cur_sequence>
              <cur_seq col_name="seq"/>
            </cur_sequence>
            <grid_methods template="Grid"/>
          </grid>
        </body>
        <button_row validate="true" template="Grid_Frame"/>
        <frame_methods template="Grid_Frame"/>
      </grid_frame>

      <grid_frame main_object="memcol">
        <toolbar template="Setup_Form"/>
        <body>

          <block/>
          <panel/>
          <row/>
          <col/>
          <label value="Col name:"/>
          <col/>
          <input fld="memcol.col_name" lng="80"/>
          <col/>
          <label value="Short descr:"/>
          <col/>
          <input fld="memcol.short_descr" lng="100"/>
          <col/>
          <label value="Col heading:"/>
          <col/>
          <input fld="memcol.col_head" lng="100"/>
          <row/>
          <col/>
          <label value="Data type:"/>
          <col/>
          <input fld="memcol.data_type" lng="80"/>
          <col/>
          <label value="Key field?"/>
          <col/>
          <input fld="memcol.key_field" lng="40"/>
          <col/>
          <label value="Null ok?"/>
          <input fld="memcol.allow_null"/>
          <col/>
          <label value="Amend ok?"/>
          <input fld="memcol.allow_amend"/>

          <row/>
          <col/>
          <label value="Long description:"/>
          <col rowspan="3" colspan="3"/>
          <input fld="memcol.long_descr" lng="300" height="3"/>

          <block/>
          <panel/>
          <row/>
          <col/>
          <label value="Max length"/>
          <input fld="memcol.max_len" lng="40"/>
          <col/>
          <label value="Scale"/>
          <input fld="memcol.db_scale" lng="40"/>
          <col/>
          <label value="Scale param"/>
          <input fld="memcol.scale_ptr" lng="60"/>
          <col/>
          <label value="Default value"/>
          <input fld="memcol.dflt_val" lng="60"/>
          <row/>
          <col/>
          <button lng="100" btn_id="chk" btn_label="Col checks"
              btn_enabled="true" btn_validate="true" action="
            <<action>>
              <<sub_form form_name=`_sys.col_checks`>>
                <<call_params>>
                  <<call_param name=`table_name` type=`data_attr` source=`memobj.name`/>>
                  <<call_param name=`col_name` type=`data_attr` source=`memcol.col_name`/>>
                  <<call_param name=`col_chks` type=`data_attr` source=`memcol.col_chks`/>>
                <</call_params>>
                <<return_params>>
                  <<return_param name=`col_chks` type=`data_attr` target=`memcol.col_chks`/>>
                <</return_params>>
                <<on_return>>
                  <<return state=`completed`/>>
                  <<return state=`cancelled`/>>
                <</on_return>>
              <</sub_form>>
            <</action>>
          "/>
          <col/>
          <button lng="100" btn_id="fkey" btn_label="Foreign key"
              btn_enabled="true" btn_validate="true" action="
            <<action>>
              <<sub_form form_name=`_sys.foreign_key`>>
                <<call_params>>
                  <<call_param name=`table_name` type=`data_attr` source=`memobj.name`/>>
                  <<call_param name=`col_name` type=`data_attr` source=`memcol.col_name`/>>
                  <<call_param name=`fkey` type=`data_attr` source=`memcol.fkey`/>>
                <</call_params>>
                <<return_params>>
                  <<return_param name=`fkey` type=`data_attr` target=`memcol.fkey`/>>
                <</return_params>>
                <<on_return>>
                  <<return state=`completed`/>>
                  <<return state=`cancelled`/>>
                <</on_return>>
              <</sub_form>>
            <</action>>
          "/>
          <col/>
          <button lng="100" btn_id="sub" btn_label="Choices"
              btn_enabled="true" btn_validate="true" action="
            <<action>>
              <<sub_form form_name=`_sys.choices`>>
                <<call_params>>
                  <<call_param name=`table_name` type=`data_attr` source=`memobj.name`/>>
                  <<call_param name=`col_name` type=`data_attr` source=`memcol.col_name`/>>
                  <<call_param name=`choices` type=`data_attr` source=`memcol.choices`/>>
                <</call_params>>
                <<return_params>>
                  <<return_param name=`choices` type=`data_attr` target=`memcol.choices`/>>
                <</return_params>>
                <<on_return>>
                  <<return state=`completed`/>>
                  <<return state=`cancelled`/>>
                <</on_return>>
              <</sub_form>>
            <</action>>
          "/>
          <col/>
          <button lng="100" btn_id="sql" btn_label="SQL"
              btn_enabled="true" btn_validate="true" action="
            <<action>>
              <<sub_form form_name=`_sys.sql`>>
                <<call_params/>>
                <<return_params/>>
                <<on_return/>>
              <</sub_form>>
            <</action>>
          "/>
        </body>
        <button_row validate="true" template="Grid_Frame"/>
        <frame_methods template="Grid_Frame"/>
      </grid_frame>
    </body>
    <button_row validate="true" template="Setup_Form"/>
    <frame_methods template="Setup_Form">
      <method name="on_start_frame" action="
        <<action>>
          <<pyfunc name=`custom.formdefn_funcs.load_mem_objects`/>>
        <</action>>
      "/>
      <method name="do_save" action="
        <<action>>
          <<check_children obj_name=`form`/>>
          <<pyfunc name=`custom.formdefn_funcs.dump_mem_objects`/>>
          <<save_obj obj_name=`form`/>>
        <</action>>
      "/>
      <method name="do_restore" action="
        <<action>>
          <<pyfunc name=`custom.formdefn_funcs.restore_mem_objects`/>>
          <<restore_obj obj_name=`form`/>>
        <</action>>
      "/>
    </frame_methods>
  </frame>
</form>
